import numpy as np

from ..core import World
from ..wind import WindProcess
from ..collision import StrictCollisionChecker
from ..utils import latlon2local


berth_latlon = [135.4110527974003, 34.63582835949745]
offshore_latlon = [135.3908711887164, 34.63044010359711]
berth_point = [0.0, 0.0]
poly1 = [
    [135.4075659148824, 34.63331349314861],
    [135.409013421793, 34.63433838300215],
    [135.4087303297437, 34.63461327228075],
    [135.4073041771545, 34.63357567403271],
]
poly2 = [
    [135.3832844905106, 34.62258591726036],
    [135.4012525852844, 34.61076173850785],
    [135.4170588173345, 34.61214182728062],
    [135.417485348258, 34.61075624059106],
    [135.4191141980484, 34.61082231010572],
    [135.420370538332, 34.61286937149811],
    [135.4183154183816, 34.61956966205551],
    [135.4037456048707, 34.61972919204671],
    [135.4022019158979, 34.62062341146505],
    [135.3995902710798, 34.62066662542693],
    [135.3894727043345, 34.62846779521559],
    [135.3872326223813, 34.62632692952124],
]
poly3 = [
    [135.4122804812167, 34.63719250244569],
    [135.4148075593339, 34.63481069207768],
    [135.4074825664467, 34.62948790910406],
    [135.4103133191639, 34.6258278194304],
    [135.4205728299486, 34.62581008636131],
    [135.4214208536259, 34.62369408132048],
    [135.4221359362829, 34.62187286614306],
    [135.4325996335653, 34.62456205505559],
    [135.4418330726762, 34.62874520258693],
    [135.4392431564526, 34.6412226740734],
    [135.4323488040034, 34.64402674794113],
    [135.424268759466, 34.64264468359747],
    [135.4198785278259, 34.64385897693621],
    [135.4177990818562, 34.64446533562957],
    [135.4165271223093, 34.64481523275914],
    [135.3988265072213, 34.63851122174749],
    [135.3975567083233, 34.638993080665],
    [135.3926796438165, 34.63545207064797],
    [135.3937758169744, 34.63052292285542],
    [135.3965693463174, 34.62850807842142],
    [135.3987293060217, 34.63132486523259],
    [135.4044902466475, 34.63153524065125],
]
polys = [poly1, poly2, poly3]


class Nanko(World):
    def __init__(self, wind=WindProcess(), col=StrictCollisionChecker()):
        super().__init__(wind, col)
        #
        self.reg_state_var(name="true_wind_speed [m/s]", ub=np.inf, lb=0.0)
        self.reg_state_var(name="true_wind_direction [rad]", ub=2 * np.pi, lb=0.0)
        self.reg_observation_var(name="true_wind_speed_hat [m/s]", ub=np.inf, lb=0.0)
        self.reg_observation_var(
            name="true_wind_direction_hat [rad]", ub=2 * np.pi, lb=0.0
        )
        for poly in polys:
            poly_local = np.array(
                [latlon2local(latlon, berth_latlon) for latlon in poly]
            )
            self.reg_obstacle_poly(poly_local)
